MAKEFLAGS += --no-print-directory

NAME = philo

CC = cc
CFLAGS = -Wall -Wextra -Werror -Iinclude

SRC_DIR = source
OBJ_DIR = objects
INC_DIR = include

SRC = $(SRC_DIR)/thread.c \
      $(SRC_DIR)/simulation_init.c \
      $(SRC_DIR)/time.c \
      $(SRC_DIR)/main.c \
      $(SRC_DIR)/cleaning.c \
      $(SRC_DIR)/creating.c \
      $(SRC_DIR)/parsing.c \
      $(SRC_DIR)/actions.c

# ðŸ”§ Proper object file paths (objects/thread.o, etc.)
OBJ = $(patsubst $(SRC_DIR)/%.c, $(OBJ_DIR)/%.o, $(SRC))

# Default target
all: $(NAME)

# ðŸ”— Link all object files into the final binary
$(NAME): $(OBJ)
	@echo "ðŸ”— Linking object files..."
	@$(CC) $(CFLAGS) -o $(NAME) $(OBJ)
	@echo "âœ… Build complete: $(NAME)"

# ðŸ”¨ Compile source files to object files
$(OBJ_DIR)/%.o: $(SRC_DIR)/%.c
	@mkdir -p $(OBJ_DIR)
	@echo "ðŸ”§ Compiling ..."
	@$(CC) $(CFLAGS) -c $< -o $@

# ðŸ§¹ Clean object files
clean:
	@echo "ðŸ§¹ Cleaning object files..."
	@rm -rf $(OBJ_DIR)

# ðŸ§½ Clean object files and the final binary
fclean: clean
	@echo "ðŸ§½ Removing binary: $(NAME)..."
	@rm -f $(NAME)

# ðŸ”„ Full rebuild
re:
	@echo "ðŸ”„ Rebuilding everything..."
	@$(MAKE) fclean
	@$(MAKE) all

.PHONY: all clean fclean re
